<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>運動紀錄</title>
  <style>
    body { font-family: "Microsoft JhengHei"; max-width: 800px; margin: 40px auto; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #f2f2f2; }
    input, select, textarea { padding: 4px; }
    .btn { padding: 6px 12px; margin-top: 10px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>🏃 運動紀錄</h1>
  <form id="logForm">
    <label>日期：<input type="date" id="date" required></label><br><br>
    <label>活動：
      <select id="activity">
        <option>健行</option>
        <option>跑步</option>
        <option>騎車</option>
        <option>游泳</option>
        <option>球類</option>
        <option>瑜伽</option>
        <option>其他</option>
      </select><br>
    </label><br><br>
    <label>時間(分鐘)：<input type="number" id="duration" min="1" required></label><br><br>
    <label>心率：<input type="number" id="heartRate" min="0"></label><br><br>
    <label>配速：<input type="text" id="pace" placeholder="7'20&quot;"></label><br><br>
    <label>備註：<textarea id="note" rows="2"></textarea></label><br><br>

    <button type="submit" class="btn">➕ 新增紀錄</button>
    <!-- ✅ 新增匯出、匯入按鈕 -->
    <button type="button" class="btn" onclick="exportJSON()">📤 匯出紀錄</button>
    <button type="button" class="btn" onclick="importJSON()">📥 匯入紀錄</button>
    <input type="file" id="importFile" accept=".json" style="display:none">
  </form>

  <table id="logTable">
    <thead>
      <tr>
        <th>日期</th><th>活動</th><th>時間(分)</th><th>心率</th><th>配速</th><th>備註</th><th>刪除</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const form = document.getElementById('logForm');
    const tbody = document.querySelector('#logTable tbody');

    function loadLogs() {
      const logs = JSON.parse(localStorage.getItem('workoutLogs') || '[]');
      tbody.innerHTML = '';
      logs.forEach((log, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${log.date}</td>
          <td>${log.activity}</td>
          <td>${log.duration}</td>
          <td>${log.heartRate}</td>
          <td>${log.pace}</td>
          <td style="white-space: pre-line;">${log.note}</td>
          <td><button onclick="deleteLog(${index})">🗑️</button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    function saveLogs(logs) {
      localStorage.setItem('workoutLogs', JSON.stringify(logs));
    }

    form.addEventListener('submit', e => {
      e.preventDefault();
      const log = {
        date: document.getElementById('date').value,
        activity: document.getElementById('activity').value,
        duration: document.getElementById('duration').value,
        heartRate: document.getElementById('heartRate').value,
        pace: document.getElementById('pace').value,
        note: document.getElementById('note').value
      };
      const logs = JSON.parse(localStorage.getItem('workoutLogs') || '[]');
      logs.push(log);
      saveLogs(logs);
      loadLogs();
      form.reset();
    });

    function deleteLog(index) {
      const logs = JSON.parse(localStorage.getItem('workoutLogs') || '[]');
      logs.splice(index, 1);
      saveLogs(logs);
      loadLogs();
    }

    // ✅ 匯出紀錄成 JSON 檔案
    function exportJSON() {
      const logs = JSON.parse(localStorage.getItem('workoutLogs') || '[]');
      if (logs.length === 0) {
        alert("目前沒有任何紀錄可匯出！");
        return;
      }
      const blob = new Blob([JSON.stringify(logs, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'workout-data.json';
      a.click();
      URL.revokeObjectURL(url);
      alert("✅ 已匯出紀錄成 JSON 檔案（workout-data.json）");
    }

    // ✅ 匯入 JSON 檔案並更新 LocalStorage
    function importJSON() {
      document.getElementById('importFile').click();
    }

    document.getElementById('importFile').addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (event) {
        try {
          const logs = JSON.parse(event.target.result);
          if (Array.isArray(logs)) {
            saveLogs(logs);
            loadLogs();
            alert("📥 匯入成功！資料已更新。");
          } else {
            alert("⚠️ 檔案格式錯誤，請確認是正確的 JSON。");
          }
        } catch (err) {
          alert("⚠️ 匯入失敗，JSON 格式不正確。");
        }
      };
      reader.readAsText(file);
      e.target.value = ""; // 重置檔案選擇器
    });

    loadLogs();
  </script>
</body>
</html>


